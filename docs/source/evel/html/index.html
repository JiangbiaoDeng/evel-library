<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AT&amp;T ECOMP Vendor Event Listener library: EVEL Library Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AT&amp;T ECOMP Vendor Event Listener library
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">EVEL Library Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction</h1>
<p>The ECOMP Vendor Event Listener ("EVEL") library encapsulates the use of AT&amp;T's JSON API to the collector function within the ECOMP infrastructure.</p>
<p>As such, it provides a reference implementation of the EVEL JSON API which can either be directly as part of a project or can be used to inform the independent implementation of an equivalent binding to the API in another development environment.</p>
<p>This section provides an overview of the library and how it is integrated into the target application. If all you want is a set of instructions to get you started, the <a class="el" href="quickstart.html">Quick Start</a> section is for you. If you want a more in-depth understanding of the <em>EVEL Library</em> then this section provides an overview and then you can read the detailed API documentation for each function. The documentation for <a class="el" href="evel_8h.html" title="Header for EVEL library. ">evel.h</a> is a good starting point, since that defines the public API of the <em>EVEL Library</em>.</p>
<h1>Library Structure</h1>
<p>The API is designed to be used on multi-process platforms where each process may be multi-threaded. Each process using this library will create an independent HTTP client (using libcURL). Each process will have a single thread running the HTTP client but that thread receives work on a ring-buffer from however may threads are required to implement the function.</p>
<p><b>Note</b>: libcurl imposes a constraint that it is initialized before the process starts multi-threaded operation.</p>
<h1>Typical Usage</h1>
<p>The library is designed to be very straightforward to use and lightweight to integrate into projects. The only serious external dependency is on libcURL.</p>
<p>The supplied Makefile produces a single library <b>libevel.so</b> or <b>libevel.a</b> which your application needs to be linked against.</p>
<p>Each process within the application which wants to generate events needs to call <a class="el" href="evel_8h.html#a059033f948f5bf406fedb4a7ef1966da" title="Library initialization. ">evel_initialize</a> at the start of day (observing the above warning about not being MT safe at this stage.) The initialization specifies the details of where the API is located. Management of configuration is the responsibility of the client.</p>
<p>Once initialized, and now MT-safe, there are factory functions to produce new events:</p><ul>
<li>Faults - <a class="el" href="evel__fault_8c.html#a6dd9b72800e61e661dc133b588aab892" title="Create a new fault event. ">evel_new_fault</a></li>
<li>Measurements - <a class="el" href="evel__scaling__measurement_8c.html#af19dc9c6757bfaa522f078a7a2248569" title="Create a new Measurement event. ">evel_new_measurement</a></li>
<li>Report - <a class="el" href="evel__reporting__measurement_8c.html#a77971f763ebf42efb1a5b0a12bbe579d" title="Create a new Report event. ">evel_new_report</a></li>
<li>State Change - <a class="el" href="evel__state__change_8c.html#a4f0a7868b54799f13f282ada5c9dcc2e" title="Create a new State Change event. ">evel_new_state_change</a></li>
<li>Syslog - <a class="el" href="evel__syslog_8c.html#ab8e1f617e4d69633fdd1f7dd297871d6" title="Create a new Syslog event. ">evel_new_syslog</a></li>
<li>Other - <a class="el" href="evel__other_8c.html#ac49e6b3de08b4d4677a7bad8d615c97b" title="Create a new Other event. ">evel_new_other</a></li>
<li>Mobile Flow - <a class="el" href="evel__mobile__flow_8c.html#a91056c1aef2f8a33a32920fdfc4fe23a" title="Create a new Mobile Flow event. ">evel_new_mobile_flow</a></li>
</ul>
<p>There is also a factory function <a class="el" href="evel__mobile__flow_8c.html#a8440103cf9c7ba48182528948d2ebc49" title="Create a new Mobile GTP Per Flow Metrics. ">evel_new_mobile_gtp_flow_metrics</a> to create the parameter gtp_per_flow_metrics, which is then configured and passed to the <a class="el" href="evel__mobile__flow_8c.html#a91056c1aef2f8a33a32920fdfc4fe23a" title="Create a new Mobile Flow event. ">evel_new_mobile_flow</a> factory function.</p>
<p>The event structures are initialized with mandatory fields at the point of creation and optional fields may be added thereafter. Once set, values in the structures are immutable.</p>
<p>Once the event is prepared, it may be posted, using <a class="el" href="evel__event__mgr_8c.html#a209d2e5dbffe9e11ac79ae140f4a81bd" title="Post an event. ">evel_post_event</a>, at which point the calling thread relinquishes all responsibility for the event. It will be freed once successfully or unsuccessfully posted to the API. If, for any reason, you change your mind and don't want to post a created event, it must be destroyed with <a class="el" href="evel_8h.html#a91faa4e06c4b079c2a8a1db1ccb2e47b" title="Free an event. ">evel_free_event</a>.</p>
<p>Finally, at the end of day, the library can be terminated cleanly by calling <a class="el" href="evel_8h.html#ab3f6225ddb9c5113d74503d4fcd17e5b" title="Clean up the EVEL library. ">evel_terminate</a>.</p>
<h2>Example Code</h2>
<p>The following fragment illustrates the above usage:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="evel_8c.html#a059033f948f5bf406fedb4a7ef1966da">evel_initialize</a>(api_fqdn,</div><div class="line">                    api_port,</div><div class="line">                    api_path,</div><div class="line">                    api_topic,</div><div class="line">                    api_secure,</div><div class="line">                    <span class="stringliteral">&quot;Alice&quot;</span>,</div><div class="line">                    <span class="stringliteral">&quot;This isn&#39;t very secure!&quot;</span>,</div><div class="line">                    <a class="code" href="evel_8h.html#a304eae0d024005dc4c7031bdd774d64aa4fbe43c85c55ae14048a2dc7fc5bfcc8">EVEL_SOURCE_VIRTUAL_MACHINE</a>,</div><div class="line">                    <span class="stringliteral">&quot;EVEL demo client&quot;</span>,</div><div class="line">                    verbose_mode))</div><div class="line">{</div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;Failed to initialize the EVEL library!!!&quot;</span>);</div><div class="line">  exit(-1);</div><div class="line">}</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">fault = <a class="code" href="evel_8h.html#a6dd9b72800e61e661dc133b588aab892">evel_new_fault</a>(<span class="stringliteral">&quot;My alarm condition&quot;</span>,</div><div class="line">                       <span class="stringliteral">&quot;It broke very badly&quot;</span>,</div><div class="line">                       <a class="code" href="evel_8h.html#ad1bf6807fa6710332251611207490484af656e2fbfee66b25faa06447799a9011">EVEL_PRIORITY_NORMAL</a>,</div><div class="line">                       <a class="code" href="evel_8h.html#ad28dcc9cce27ecb7e4c9020107a6db9cac454e36d0a4678cd7ae2de725f513b61">EVEL_SEVERITY_MAJOR</a>);</div><div class="line"><span class="keywordflow">if</span> (fault != NULL)</div><div class="line">{</div><div class="line">  <a class="code" href="evel_8h.html#a08233f1e66ab6cdb0998fb3f5495ac45">evel_fault_type_set</a>(fault, <span class="stringliteral">&quot;Bad things happen...&quot;</span>);</div><div class="line">  <a class="code" href="evel_8h.html#a60ccecf94decb577e09fac9ee34358f2">evel_fault_interface_set</a>(fault, <span class="stringliteral">&quot;My Interface Card&quot;</span>);</div><div class="line">  <a class="code" href="evel_8h.html#a07076c0fa1d2941102f957af3b47df44">evel_fault_addl_info_add</a>(fault, <span class="stringliteral">&quot;name1&quot;</span>, <span class="stringliteral">&quot;value1&quot;</span>);</div><div class="line">  <a class="code" href="evel_8h.html#a07076c0fa1d2941102f957af3b47df44">evel_fault_addl_info_add</a>(fault, <span class="stringliteral">&quot;name2&quot;</span>, <span class="stringliteral">&quot;value2&quot;</span>);</div><div class="line">  evel_rc = <a class="code" href="evel_8h.html#a209d2e5dbffe9e11ac79ae140f4a81bd">evel_post_event</a>((<a class="code" href="structevent__header.html">EVENT_HEADER</a> *)fault);</div><div class="line">  <span class="keywordflow">if</span> (evel_rc != <a class="code" href="evel_8h.html#ae1f68b0d21fb98defcec46e99208a03eaa9369500f041c2898e5c2b4f07b6d152">EVEL_SUCCESS</a>)</div><div class="line">  {</div><div class="line">    <a class="code" href="evel_8h.html#afdddf91265803ed3fd502fedd7dabebf">EVEL_ERROR</a>(<span class="stringliteral">&quot;Post failed %d (%s)&quot;</span>, evel_rc, <a class="code" href="evel_8h.html#acc6a1997021796b0a09fcdb8e89ea384">evel_error_string</a>());</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>The public API to the library is defined in <a class="el" href="evel_8h.html" title="Header for EVEL library. ">evel.h</a>. The internal APIs within library are defined in separate headers (<em>e.g.</em> <a class="el" href="evel__internal_8h.html" title="EVEL internal definitions. ">evel_internal.h</a>), but these should not need to be included by the code using the library.</p>
<h1>Example Application</h1>
<p>A simple command-line application to generate events is provided as part of the source package (the above code fragment is taken from that application).</p>
<p>The following illustrates its operation to a co-located "test-collector": </p><div class="fragment"><div class="line">$ ./evel_demo --fqdn 127.0.0.1 --port 30000 --path vendor_event_listener --topic example_vnf --verbose</div><div class="line">./evel_demo built Feb 26 2016 18:14:48</div><div class="line">* About to connect() to 169.254.169.254 port 80 (#0)</div><div class="line">*   Trying 169.254.169.254... * Timeout</div><div class="line">* connect() timed out!</div><div class="line">* Closing connection #0</div><div class="line">* About to connect() to 127.0.0.1 port 30000 (#0)</div><div class="line">*   Trying 127.0.0.1... * connected</div><div class="line">* Connected to 127.0.0.1 (127.0.0.1) port 30000 (#0)</div><div class="line">* Server auth using Basic with user &#39;Alice&#39;</div><div class="line">&gt; POST /vendor_event_listener/eventListener/v1/example_vnf HTTP/1.1</div><div class="line">Authorization: Basic QWxpY2U6VGhpcyBpc24ndCB2ZXJ5IHNlY3VyZSE=</div><div class="line">User-Agent: libcurl-agent/1.0</div><div class="line">Host: 127.0.0.1:30000</div><div class="line">Accept: */*</div><div class="line">Content-type: application/json</div><div class="line">Content-Length: 510</div><div class="line"></div><div class="line">* HTTP 1.0, assume close after body</div><div class="line">&lt; HTTP/1.0 204 No Content</div><div class="line">&lt; Date: Fri, 04 Mar 2016 15:37:22 GMT</div><div class="line">&lt; Server: WSGIServer/0.1 Python/2.6.6</div><div class="line">&lt; </div><div class="line">* Closing connection #0</div><div class="line">* About to connect() to 127.0.0.1 port 30000 (#0)</div><div class="line">*   Trying 127.0.0.1... * connected</div><div class="line">* Connected to 127.0.0.1 (127.0.0.1) port 30000 (#0)</div><div class="line">* Server auth using Basic with user &#39;Alice&#39;</div><div class="line">&gt; POST /vendor_event_listener/eventListener/v1/example_vnf HTTP/1.1</div><div class="line">Authorization: Basic QWxpY2U6VGhpcyBpc24ndCB2ZXJ5IHNlY3VyZSE=</div><div class="line">User-Agent: libcurl-agent/1.0</div><div class="line">Host: 127.0.0.1:30000</div><div class="line">Accept: */*</div><div class="line">Content-type: application/json</div><div class="line">Content-Length: 865</div><div class="line"></div><div class="line">* HTTP 1.0, assume close after body</div><div class="line">&lt; HTTP/1.0 204 No Content</div><div class="line">&lt; Date: Fri, 04 Mar 2016 15:37:22 GMT</div><div class="line">&lt; Server: WSGIServer/0.1 Python/2.6.6</div><div class="line">&lt; </div><div class="line">* Closing connection #0</div><div class="line">* About to connect() to 127.0.0.1 port 30000 (#0)</div><div class="line">*   Trying 127.0.0.1... * connected</div><div class="line">* Connected to 127.0.0.1 (127.0.0.1) port 30000 (#0)</div><div class="line">* Server auth using Basic with user &#39;Alice&#39;</div><div class="line">&gt; POST /vendor_event_listener/eventListener/v1/example_vnf HTTP/1.1</div><div class="line">Authorization: Basic QWxpY2U6VGhpcyBpc24ndCB2ZXJ5IHNlY3VyZSE=</div><div class="line">User-Agent: libcurl-agent/1.0</div><div class="line">Host: 127.0.0.1:30000</div><div class="line">Accept: */*</div><div class="line">Content-type: application/json</div><div class="line">Content-Length: 2325</div><div class="line"></div><div class="line">* HTTP 1.0, assume close after body</div><div class="line">&lt; HTTP/1.0 204 No Content</div><div class="line">&lt; Date: Fri, 04 Mar 2016 15:37:22 GMT</div><div class="line">&lt; Server: WSGIServer/0.1 Python/2.6.6</div><div class="line">&lt; </div><div class="line">* Closing connection #0</div><div class="line">^C</div><div class="line"></div><div class="line">Interrupted - quitting!</div><div class="line">$</div></div><!-- fragment --><h1>Restrictions and Limitations</h1>
<h2>Constraint Validation</h2>
<p>The <em>EVEL Library</em> has been designed to be production-safe code with the emphasis at this stage being in correctness of operation rather than raw performance.</p>
<p>The API tries to check as much information as possible to avoid misuse and will <b>assert()</b> if constraints are not satisfied. This is likely to lead to the rapid discovery of coding errors by programmers, but does mean that the application can fail abruptly if the library is misused in any way.</p>
<h2>Performance</h2>
<p>The default Makefile avoids aggressive optimizations so that any core-files are easy to interpret. Production code should use greater optimization levels.</p>
<p>As described above, the HTTP client is single threaded and will run all transactions synchronously. As transactions are serialized, a client that generates a lot of events will be paced by the round-trip time.</p>
<p>It would be a straightforward enhancement to use the multi-thread API into libcurl and use a pool of client threads to run transactions in parallel if this ever became a bottleneck.</p>
<h2>Logging</h2>
<p>The initialization of the library includes the log verbosity. The verbose operation makes the library very chatty so syslog may get rather clogged with detailed diagnostics. It is possible to configure syslog to put these events into a separate file. A trivial syslog.conf file would be:</p>
<div class="fragment"><div class="line"># Log all user messages so debug information is captured.</div><div class="line"></div><div class="line">user.*      /var/log/debug</div></div><!-- fragment --><p>If verbose logging is enabled, the cURL library will generate information about the HTTP operations on <b>stdout</b>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
